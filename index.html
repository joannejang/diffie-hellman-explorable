<head>
	<title> Diffie-Hellman Key Exchange: An Explorable </title>
	<link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro" rel="stylesheet">
	<link href="css/main.css" rel="stylesheet">
	<!-- Plus by arjuazka from the Noun Project -->
	<!-- Equal by Eagle Eye from the Noun Project -->
</head>

<script src="js/jscolor/jscolor.js"></script>
<script src="js/interact.min.js"></script>

<body onload=showPicker();>

	<div id="intro_container">
		<div id="title">
			<h1>
				Diffie-Hellman Key Exchange
			</h1>
		</div>
		<div id="subtitle">
			An Explorable Explanation by Joanne Jang, Clay Jones, Jessica Ouyang
		</div>
	</div>

	<div class="chapter">
		<h2> Introduction </h2>
		<p> [VERY general overview on encryption and key exchange] </p>
	</div>

	<div class="chapter">
		<h2> One-way Functions </h2>


		<div id="visual_box">
			<div id="drag-1" class="draggable" style="background-color: yellow;"> </div>

			<div id="drag-2" class="draggable" style="background-color: blue;"> </div>

			<div id="intersection" stule="background-color: blue;"></div>

		</div>

		<p>
			<b> Unmixing paint is hard. </b>
		</p>
		Given a color, can you try to find its 2 comprising paint colors?

		<div class="interactive">
			<div id="goal">
				Goal Color:
				<p id="goal_color" style="border:1px solid gray; width:100px; height:100px; background-color: #d1adc2; margin-top: 20px;">

				</p>
			</div>

			<br/>
			<div id="color-wrapper">

				<div id="color1">
					<button
					    style="border:1px solid gray; font-family: 'Source Sans Pro', sans-serif; text-align: center; background-color: #3dc6a0;"> <!--  -->
					    Color 1
					</button>

					<p id="circ1" style="border:1px solid gray; width:100px; height:100px; background-color: #3dc6a0;"/>
				</div>
				<div class="crop">
					<img src="img/plus.svg"/>
				</div>

				<div id="color2">

					<input id="color_input" class="jscolor {position: 'bottom', shadow: 'false', shadowBlur: '0', smartPosition: 'false'}" onchange="updateCirc2(this.jscolor)" style="font-size:0px;"/>
				</div>

				<div class="crop">
					<img src="img/equal.svg"/>
				</div>

				<div id="mixed">
				Mixed Color:
				<p id="mixed_color" style="border:1px solid gray; width:100px; height:100px; margin-top: 10px; margin-bottom: 20px;">

				</p>
			</div>
			</div>

			<div id="match">
				NOT A MATCH
	
			</div>
				<div id="attempts">
				# of Attempt(s): 0
				</div>
		</div>
		<p>
			... but if you knew the two colors, mixing them isn't hard.
		</p>


	</div>
	<br/>

	<div class="chapter">
		<h2> Next Section </h2>
		<p> Cool. </p>
	</div>




</body>

<script>

	// target elements with the "draggable" class
interact('.draggable')
  .draggable({
    // enable inertial throwing
    inertia: true,
    // keep the element within the area of it's parent
    restrict: {
      restriction: "parent",
      endOnly: true, //false,
      elementRect: { top: 0, left: 0, bottom: 1, right: 1}
    },
    // enable autoScroll
    autoScroll: true,

    // call this function on every dragmove event
    onmove: dragMoveListener,
    // call this function on every dragend event
    onend: function (event) {
    	// leaving this be for later
    }
  });

  var blue_x1 = 200; //205;
  var blue_x2 = 500; // 405;
  var yellow_x1 = 0;
  var yellow_x2 = 200;

  var intersect_x1 = 0;
  var intersect_x2 = 0;
  var old_intersect_x1 = 0;


  function dragMoveListener (event) {

    var target = event.target,
        // keep the dragged position in the data-x/data-y attributes
        x = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx,
        y = (parseFloat(target.getAttribute('data-y')) || 0);



    // translate the element
    target.style.webkitTransform =
    target.style.transform =
      'translate(' + x + 'px, ' + y + 'px)';

    // update the posiion attributes
    target.setAttribute('data-x', x);

    target.setAttribute('data-y', y);


    var intersection = document.getElementById('intersection');
    intersection.style.backgroundColor = "green";
    console.log(x);



    if (target.style.backgroundColor == "blue") {
 		blue_x1 = x + 200; // initial x offset
 		blue_x2 = blue_x1 + 300; // width offset
    } else { // yellow
    	yellow_x1 = x;
 		yellow_x2 = yellow_x1 + 200; // width offset
    }

    console.log(blue_x1, blue_x2, yellow_x1, yellow_x2);

	if (((yellow_x1 > blue_x2 && yellow_x2 > blue_x2)) ||
		(blue_x1 > yellow_x2 && blue_x2 > yellow_x2)) {
    	// no intersection
    	intersection.style.width = 0;
    	intersect_x2 = intersect_x1;
    	console.log("no intersection");

    } else {
    	// intersection
    	old_intersect_x1 = intersect_x1;
    	console.log("INTERSECTION");
    	if (yellow_x1 > blue_x1 && yellow_x2 < blue_x2) {
    		intersect_x1 = yellow_x1;
    		intersect_x2 = yellow_x2;
    	} else if (yellow_x2 > blue_x2) {
    		intersect_x1 = yellow_x1;
    		intersect_x2 = blue_x2;
    		intersection.style.width = intersect_x2 - intersect_x1;

    	} else if (blue_x2 > yellow_x2) {
    		intersect_x1 = blue_x1;
    		intersect_x2 = yellow_x2;
    		intersection.style.width = intersect_x2 - intersect_x1;
    	}

    }

    intersection.style.position = "absolute";
    intersection.style.left = intersect_x1;



  }


		function showPicker() {
			document.getElementById('color_input').jscolor.show();
		}
		

		function updateCirc1(jscolor) {

		}

		var attempts = 0;
		var color1 = "rgb(61, 198, 160)";
		var color2;
		function updateCirc2(jscolor) {


			console.log(jscolor);
			color2 = jscolor.toRGBString();
		    // 'jscolor' instance can be used as a string
		    // document.getElementById('circ2').style.backgroundColor = '#' + jscolor;

		    updateMixedColor(jscolor);
		    attempts += 1;
		    document.getElementById('attempts').innerHTML = "# of Attempt(s): " + attempts;
		}

		function updateMixedColor(jscolor) {
			// color1 = document.getElementById('circ1').style.backgroundColor;
			// console.log(color1);
			// color2 = document.getElementById('circ2').style.backgroundColor;
			console.log(color2);

			cmyk_color1 = RGBtoCMYK(color1);
			cmyk_color2 = RGBtoCMYK(color2);

			rgb_mixed_color = mixColors(cmyk_color1, cmyk_color2);
			console.log(rgb_mixed_color);

			document.getElementById('mixed_color').style.backgroundColor = rgb_mixed_color;	
			// document.getElementById('color_input').jscolor.show();
		}

		function RGBtoCMYK(color) {
			rgb = color.substring(4, color.length-1)
         			.replace(/ /g, '')
         			.split(',');

			cyan    = 255 - rgb[0];
  			magenta = 255 - rgb[1];
  			yellow  = 255 - rgb[2];
  			black   = Math.min(cyan, magenta, yellow);
  			cyan    = ((cyan - black) / (255 - black));
  			magenta = ((magenta - black) / (255 - black));
  			yellow  = ((yellow  - black) / (255 - black));

  			return {c:cyan,m:magenta,y:yellow,k:black/255,a:50};
		}

		function CMYKtoRGB(color) {
		  color.c = color.c;
		  color.m = color.m;
		  color.y = color.y;
		  color.k = color.k;
		  R = color.c * (1.0 - color.k) + color.k;
		  G = color.m * (1.0 - color.k) + color.k;
		  B = color.y * (1.0 - color.k) + color.k;
		  R = Math.round((1.0 - R) * 255.0 + 0.5);
		  G = Math.round((1.0 - G) * 255.0 + 0.5);
		  B = Math.round((1.0 - B) * 255.0 + 0.5);
		  RGB_str = "rgb(" + R + "," + G + "," + B + ")"
		  return RGB_str;
		}
		function mixColors(color1, color2){
		  if(typeof(color1)=='object'&&(color1 instanceof Array)==false)
		    color1 = new Array(color1,color2);

		  C = 0;
		  M = 0;
		  Y = 0;
		  K = 0;
		  A = 0;
		  for(var i=0;i<color1.length;i++){
		    C += color1[i].c;
		    M += color1[i].m;
		    Y += color1[i].y;
		    K += color1[i].k;
		    A += color1[i].a;
		  }
		  C = C/color1.length;
		  M = M/color1.length;
		  Y = Y/color1.length;
		  K = K/color1.length;
		  A = A/color1.length;
		  color = {c:C,m:M,y:Y,k:K,a:A};
		  color = CMYKtoRGB(color);
		  return color;
		}
</script>